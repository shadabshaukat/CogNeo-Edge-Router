############################################################
# CogNeo-Edge-Router Environment Configuration (.env)
#
# This file is loaded by Pydantic Settings at startup.
# All values are strings; booleans are 0/1.
# The Router also accepts legacy names (ROUTER_REQUEST_TIMEOUT,
# ROUTER_UPSTREAM_TIMEOUT) for compatibility, but the canonical
# names below are recommended.
############################################################

#############################
# Router Settings
#############################

# REQUEST_TIMEOUT: Default request timeout (seconds) for this Router API.
#   - Integer seconds, e.g., 30, 60, 120.
REQUEST_TIMEOUT=30

# UPSTREAM_TIMEOUT: HTTP timeout (seconds) used for calls to upstream CogNeo stacks.
#   - Integer seconds.
UPSTREAM_TIMEOUT=30

# TENANTS_CONFIG: Path to the routing config file (YAML).
#   - Relative or absolute path (e.g., tenants.yaml, /etc/router/tenants.yaml).
TENANTS_CONFIG=tenants.yaml

#############################
# Tenancy
#############################

# TENANCY_ENABLE: Enable multi-tenant routing by X-Tenant-Id header.
#   - 0 = disabled (Router uses the "default" block in tenants.yaml; X-Tenant-Id not required)
#   - 1 = enabled  (X-Tenant-Id header required; Router uses tenants.<id> in tenants.yaml)
TENANCY_ENABLE=0

#############################
# CORS
#############################

# CORS_ENABLE: Enable/disable CORS middleware for this Router.
#   - 0 = disabled, 1 = enabled
CORS_ENABLE=1

# CORS_ALLOW_ORIGINS: Comma-separated list of allowed origins.
#   - Use * to allow all or specify domains, e.g.:
#     https://example.com,https://app.example.com
CORS_ALLOW_ORIGINS=*

#############################
# Metrics
#############################

# METRICS_ENABLE: Expose Prometheus metrics endpoint at /metrics
#   - 0 = disabled, 1 = enabled
METRICS_ENABLE=1

#############################
# Cache (Valkey/Redis)
#############################

# CACHE_ENABLE: Enable response caching via Valkey/Redis.
#   - 0 = disabled, 1 = enabled
CACHE_ENABLE=1

# CACHE_TTL: Cache TTL in seconds for cached responses.
#   - Integer seconds (e.g., 60, 300, 600)
CACHE_TTL=3600

# CACHE_URL: Connection URL for Valkey/Redis.
#   - Plaintext: redis://host:port/db
#   - TLS     : rediss://host:port/db
#   Examples:
#     redis://localhost:6379/0
#     rediss://cache.example.com:6380/0
# Password-only: CACHE_URL=rediss://:PASSWORD@host:6379/0
# User+password: CACHE_URL=rediss://USER:PASSWORD@host:6379/0
CACHE_URL=rediss://aaawiclygaascx2u5m2zo55s27ur7ksa3gge7xvihigpv4d74l5xq6a-d.redis.us-sanjose-1.oci.oraclecloud.com:6379/0

# CACHE_TLS_VERIFY: TLS certificate verification for rediss:// URLs.
#   - 1 = verify TLS certificates (recommended in production)
#   - 0 = skip verification (testing only)
CACHE_TLS_VERIFY=1
# CACHE_CONNECT_TIMEOUT: Seconds to wait when establishing a TCP/TLS connection to the cache (Valkey/Redis)
CACHE_CONNECT_TIMEOUT=2.0
# CACHE_SOCKET_TIMEOUT: Seconds allowed for read/write operations with the cache
CACHE_SOCKET_TIMEOUT=4.0
# CACHE_CLUSTER_ENABLE: Enable Valkey/Redis Cluster client (use when you see MOVED redirections)
#   - 0 = disabled (single-node client)
#   - 1 = enabled  (cluster-aware client that follows redirections)
CACHE_CLUSTER_ENABLE=1

# CACHE_NORMALIZE_QUERY: Normalize query text before hashing cache keys to improve cache hit-rate for trivial variations
#   - 0 = disabled (default behavior: exact-key caching)
#   - 1 = enabled  (lowercase, collapse whitespace, strip punctuation; applied only to cache key for:
#                   vector/hybrid/fts -> "query", rag -> "question", chat -> "message")
CACHE_NORMALIZE_QUERY=1

#############################
# Semantic Cache (Optional)
#############################
# SEMCACHE_ENABLE: Enable semantic cache (router-side) to reuse responses for semantically similar questions
#   - 0 = disabled, 1 = enabled
SEMCACHE_ENABLE=1

# SEMCACHE_PROVIDER: Backend for semantic cache storage/index
#   - memory     = in-process ephemeral store (single router instance, non-durable)
#   - opensearch = OpenSearch k-NN vector index
#   - pgvector   = PostgreSQL + pgvector extension
# For dev/single-instance without external store:
# SEMCACHE_PROVIDER=memory
SEMCACHE_PROVIDER=memory

# SEMCACHE_THRESHOLD: Cosine similarity threshold for semantic cache hits (0..1, higher is stricter)
SEMCACHE_THRESHOLD=0.90

# SEMCACHE_TTL: TTL (seconds) for semantic cache entries
SEMCACHE_TTL=3600

# SEMCACHE_EMBEDDER: Embedding model to use in the router (fastembed)
#   - fastembed_e5_small -> BAAI/bge-small-en-v1.5 (384 dim, CPU friendly)
SEMCACHE_EMBEDDER=fastembed_e5_small
# SEMCACHE_DIM: Embedding dimension (384 for e5-small)
SEMCACHE_DIM=384

# OpenSearch semantic cache settings
#   - SEMCACHE_OS_URL: Base URL for OpenSearch (http or https)
#   - SEMCACHE_OS_INDEX: Index name to store semantic entries
#   - Optional basic auth: SEMCACHE_OS_USER / SEMCACHE_OS_PASS
SEMCACHE_OS_URL=http://localhost:9200
SEMCACHE_OS_INDEX=semcache
SEMCACHE_OS_USER=
SEMCACHE_OS_PASS=

# pgvector semantic cache settings
#   - SEMCACHE_PG_DSN: PostgreSQL DSN with pgvector installed
#   - SEMCACHE_PG_TABLE: Table to store semantic entries
SEMCACHE_PG_DSN=postgresql://postgres:postgres@localhost:5432/postgres
SEMCACHE_PG_TABLE=semcache

############################################################
# Legacy / Compatibility (optional)
# The Router supports these legacy env names if present.
# Prefer the canonical names above. Leave commented unless needed.
#
# ROUTER_REQUEST_TIMEOUT=30
# ROUTER_UPSTREAM_TIMEOUT=30
############################################################
